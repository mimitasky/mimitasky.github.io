<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WEB CHORD KEYBOARD</title>
  <script>
    document.oncontextmenu = () => {
      return false;
    };

    const defChordName = ['M', 'm', 'maj7', '7th', 'm7', 'mM7', 'sus4', '7sus4', '6th', 'm6', 'aug', 'dim', 'dim7', 'm7(♭5)', 'add9', 'madd9', 'maj7(9)', '7(9)', 'm7(9)', '7(♯9)', 'maj7(13)', '7(13)', '7(♭13)', ''];
    let chordName = defChordName;
    const chordValue = {
      'M':[0,4,7,null,null],
      'm':[0,3,7,null,null],
      'maj7':[0,4,7,11,null],
      '7th':[0,4,7,10,null],
      'm7':[0,3,7,10,null],
      'mM7':[0,3,7,11,null],
      'sus4':[0,5,7,null,null],
      '7sus4':[0,5,7,10,null],
      '6th':[0,4,7,9,null],
      'm6':[0,3,7,9,null],
      'aug':[0,4,8,null,null],
      'dim':[0,3,6,null,null],
      'dim7':[0,3,6,9,null],
      'm7(♭5)':[0,3,6,10,null],
      'add9':[0,2,4,7,null],
      'madd9':[0,2,3,7,null],
      'maj7(9)':[0,2,4,7,11],
      '7(9)':[0,2,4,7,10],
      'm7(9)':[0,2,3,7,10],
      '7(♯9)':[0,4,7,10,3], 
      'maj7(13)':[0,4,7,11,9],
      '7(13)':[0,4,7,10,9],
      '7(♭13)':[0,4,7,10,8], 
      '': [null,null,null,null,null] 
    };
    const chordNo = ['c01', 'c02', 'c03', 'c04', 'c05', 'c06', 'c07', 'c08', 'c09', 'c10', 'c11', 'c12', 'c13', 'c14', 'c15', 'c16', 'c17', 'c18', 'c19', 'c20', 'c21', 'c22', 'c23', 'c24'];
    const wKey = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    const bKey = ['C#', 'D#', 'F#', 'G#', 'A#'];
    const allKey = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const frqList = [261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392.00, 415.30, 440.00, 466.16, 493.88];

    const about_jp = 
      'WEB CHORD KEYBOARD は、ブラウザ上でコードと音をすばやく確認できるシンプルなツールです。'
      + '<br>'
      + 'インストールやアカウント登録は不要で、スマートフォンや PC からすぐに利用できます。'
      + '<br>'
      + '<br>'
      + '演奏や作曲のアイデア出し、コードの確認、音のチェックなど、ちょっとした場面で気軽に使えることを目的に作られています。'
      + '<br>'
      + '<br>'
      + 'このツールのソースコードは GitHub で公開しています。'
      + 'https://github.com/mimitasky/mimitasky.github.io';

    const privacy_jp = 
      'このツールは、ユーザーの個人情報を一切収集しません。'
      + '<br>'
      + '入力されたキーやコード、操作内容はサーバーに送信されず、すべてブラウザ内で処理されます。'
      + '<br>'
      + '<br>'
      + 'Cookie やアクセス解析ツールも使用していません。'
      + '<br>'
      + '<br>'
      + '・個人情報の収集：なし'
      + '<br>'
      + '・外部へのデータ送信：なし'
      + '<br>'
      + '・アカウント登録：不要'
      + '<br>'
      + '・音声処理：すべて端末内で完結';

    const about_en = 
      'WEB CHORD KEYBOARD is a simple tool for quickly checking chords and sounds directly in your browser.'
     + '<br>'
     + 'No installation or account registration is required.'
     + '<br>'
     + 'You can use it immediately on both smartphones and PCs.'
     + '<br>'
     + '<br>'
     + 'It is designed for quick tasks such as checking chord shapes, confirming notes, trying ideas for composition, or simply hearing how something sounds.'
     + '<br>'
     + '<br>'
     + 'The source code for this tool is available on GitHub:'
     + '<br>'
     + 'https://github.com/mimitasky/mimitasky.github.io';

    const privacy_en = 
      'This tool does not collect any personal information.'
     + '<br>'
     + 'All key inputs, chord selections, and operations are processed entirely within your browser and are not sent to any server.'
     + '<br>'
     + '<br>'
     + 'No cookies or analytics tools are used.'
     + '<br>'
     + '<br>'
     + '• Personal data collected: none'
     + '<br>'
     + '• External data transmission: none'
     + '<br>'
     + '• Account registration: not required'
     + '<br>'
     + '• Audio processing: performed entirely on the user\'s device';

    const userLangs = navigator.language || navigator.userLanguage;

    function showMain() {
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
      let osc = audioCtx.createOscillator();
      osc.type = 'sawtooth';
      osc.frequency.value = 440.00;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime);
      osc = null;
      document.getElementById('start').style.display = 'none';
      document.getElementById('main').style.display = 'block';
      fncResize();
    }

    function fncLoad() {
      const about = document.getElementById('about');
      const privacy = document.getElementById('privacy');
      if (userLangs.includes('ja') || userLangs.includes('ja-JP')) {
        about.innerHTML = about_jp;
        privacy.innerHTML = privacy_jp;
      }
      else {
        about.innerHTML = about_en;
        privacy.innerHTML = privacy_en;
      }

      fncResize();
    }

    function fncResize() {
      let screenHeight = window.innerHeight;
      let screenWidth = window.innerWidth;
      let btnHeight = 0;
      let btnWidth = 0;

      if (screenHeight >= screenWidth) {
        screenHeight = window.innerHeight;
        screenWidth = window.innerWidth;

        let addBoxHeight = screenHeight;
        let addBoxWidth = Math.floor(screenWidth * 0.1);
        let addBoxTop = 0;
        let addBoxLeft = screenWidth - addBoxWidth;
        screenWidth = window.innerWidth - addBoxWidth;

        document.getElementById('add-box').style.position = 'fixed';
        document.getElementById('add-box').style.top = addBoxTop + 'px';
        document.getElementById('add-box').style.left = addBoxLeft + 'px';
        document.getElementById('add-box').style.height = addBoxHeight + 'px';
        document.getElementById('add-box').style.width = addBoxWidth + 'px';

        let nameBoxHeight = Math.floor(screenHeight * 0.5);
        let nameBoxWidth = Math.floor(screenWidth * 0.4);
        let nameBoxTop = 0;
        let nameBoxLeft = screenWidth - nameBoxWidth;

        document.getElementById('csn-box').style.position = 'fixed';
        document.getElementById('csn-box').style.top = nameBoxTop + 'px';
        document.getElementById('csn-box').style.left = nameBoxLeft + 'px';
        document.getElementById('csn-box').style.height = nameBoxHeight + 'px';
        document.getElementById('csn-box').style.width = nameBoxWidth + 'px';

        let keyBoxHeight = Math.floor(screenHeight * 0.5);
        let keyBoxWidth = screenWidth - nameBoxWidth;
        let keyBoxTop = 0;
        let keyBoxLeft = 0;

        document.getElementById('key-box').style.position = 'fixed';
        document.getElementById('key-box').style.top = keyBoxTop + 'px';
        document.getElementById('key-box').style.left = keyBoxLeft + 'px';
        document.getElementById('key-box').style.height = keyBoxHeight + 'px';
        document.getElementById('key-box').style.width = keyBoxWidth + 'px';

        let btnBoxHeight = screenHeight - keyBoxHeight;
        let btnBoxWidth = screenWidth;
        let btnBoxTop = keyBoxHeight;
        let btnBoxLeft = 0;
        let btnColSize = 3;

        document.getElementById('btn-box').style.position = 'fixed';
        document.getElementById('btn-box').style.top = btnBoxTop + 'px';
        document.getElementById('btn-box').style.left = btnBoxLeft + 'px';
        document.getElementById('btn-box').style.height = btnBoxHeight + 'px';
        document.getElementById('btn-box').style.width = btnBoxWidth + 'px';

        let wWidth = keyBoxWidth;
        let bWidth = wWidth - Math.floor(wWidth / 2);

        let wTempHeight = 0;
        let wTempHeightRest = 0;
        let wHeight =  [0,0,0,0,0,0,0];
        let bHeight = [0,0,0,0,0];

        wTempHeight = Math.floor(keyBoxHeight / 7);
        wTempHeightRest = keyBoxHeight - (wTempHeight * 7);

        for (let i = 0; i < wHeight.length; i++) {
          wHeight[i] =  wTempHeight;
        }
        for (let i = 0; i < wTempHeightRest; i++) {
          wHeight[Math.floor(i % 7)] = wHeight[Math.floor(i % 7)] + 1;
        }

        for (let i = 0; i < bHeight.length; i++) {
          bHeight[i] = Math.floor(wHeight[0] / 2);
        }

        let tempTop = 0;
        for (let i = 0; i < wHeight.length; i++) {
          let e = document.getElementById(wKey[i]);
          e.style.position = 'absolute';
          e.style.top = (tempTop) + 'px';
          e.style.left = '0px';
          e.style.height = wHeight[i] + 'px';
          e.style.width = wWidth + 'px';
          e.classList.remove('white-key-h');
          e.classList.add('white-key-v');
          tempTop = tempTop + wHeight[i];
        }

        for (let i = 0; i < bKey.length; i++) {
          let eb = document.getElementById(bKey[i]);
          let ew = document.getElementById(bKey[i].substring(0, 1));
          eb.style.position = 'absolute';
          eb.style.top = (Number(ew.style.top.replace('px', '')) + Math.floor(wHeight[0] / 4) * 3) + 'px';
          eb.style.left = (keyBoxWidth - bWidth) + 'px';
          eb.style.height = (Math.floor(wHeight[0] / 2)) + 'px';
          eb.style.width = bWidth + 'px';
        }

        btnHeight = Math.floor(btnBoxHeight / btnColSize) - 2;
        btnWidth = Math.floor(btnBoxWidth / (chordNo.length / btnColSize)) - 2;

        for (let i = 1; i <= chordName.length; i++) {
          let e = document.getElementById('c' + String(i).padStart(2, '0'));
          let en = document.getElementById('cn' + String(i).padStart(2, '0'));
          let tempTop = 0;
          let tempLeft = btnBoxWidth - btnWidth;

          e.style.position = 'absolute';
          tempTop = (btnHeight * ((i - 1) % btnColSize)) + Math.floor(btnHeight * (1 / 10));
          tempLeft = btnBoxWidth - (btnWidth * (Math.floor((i - 1) / btnColSize) + 1));
          e.style.top = tempTop + 'px';
          e.style.left = tempLeft + 'px';
          e.style.height = Math.floor(btnHeight * (8 / 10)) + 'px';
          e.style.width = Math.floor(btnWidth * (8 / 10)) + 'px';
          e.style.lineHeight = '1px';

          if (chordName[i - 1] != '') {
            e.style.visibility = 'visible';
            en.style.visibility = 'visible';
            en.innerHTML = chordName[i - 1]; 
          }
          else {
            e.style.visibility = 'hidden';
            en.style.visibility = 'hidden';
          }

          en.classList.add('rotated-text');
        }

        const ttl = document.getElementById('ttl');
        const addH = addBoxHeight;
        ttl.classList.add('rotated-text');
        ttl.style.fontSize = Math.floor(addH * 0.04) + 'px';
        ttl.style.position = 'absolute';
        ttl.style.top = '25%';
        ttl.style.left = '50%';
        ttl.style.transform = 'translate(-50%, -50%) rotate(90deg)';

        document.getElementById('csn').classList.add('rotated-text');
      }
      else {
        screenHeight = Math.floor(window.innerHeight * 0.98);
        screenWidth = window.innerWidth;

        let addBoxHeight = Math.floor(screenHeight * 0.1);
        let addBoxWidth = Math.floor(screenWidth * 0.5);
        let addBoxTop = 0;
        let addBoxLeft = 0;

        document.getElementById('add-box').style.position = 'fixed';
        document.getElementById('add-box').style.top = addBoxTop + 'px';
        document.getElementById('add-box').style.left = addBoxLeft + 'px';
        document.getElementById('add-box').style.height = addBoxHeight + 'px';
        document.getElementById('add-box').style.width = addBoxWidth + 'px';

        let nameBoxHeight = Math.floor((screenHeight - addBoxHeight) * 0.4);
        let nameBoxWidth = Math.floor(screenWidth * 0.5);
        let nameBoxTop = addBoxHeight;
        let nameBoxLeft = 0;

        document.getElementById('csn-box').style.position = 'fixed';
        document.getElementById('csn-box').style.top = nameBoxTop + 'px';
        document.getElementById('csn-box').style.left = nameBoxLeft + 'px';
        document.getElementById('csn-box').style.height = nameBoxHeight + 'px';
        document.getElementById('csn-box').style.width = nameBoxWidth + 'px';

        let keyBoxHeight = screenHeight - addBoxHeight -  nameBoxHeight;
        let keyBoxWidth = Math.floor(screenWidth * 0.5);
        let keyBoxTop = addBoxHeight + nameBoxHeight;
        let keyBoxLeft = 0;

        document.getElementById('key-box').style.position = 'fixed';
        document.getElementById('key-box').style.top = keyBoxTop + 'px';
        document.getElementById('key-box').style.left = keyBoxLeft + 'px';
        document.getElementById('key-box').style.height = keyBoxHeight + 'px';
        document.getElementById('key-box').style.width = keyBoxWidth + 'px';

        let btnBoxHeight = screenHeight - addBoxHeight;
        let btnBoxWidth = screenWidth - keyBoxWidth;
        let btnBoxTop = addBoxHeight
        let btnBoxLeft = keyBoxWidth;
        let btnColSize = 3;

        document.getElementById('btn-box').style.position = 'fixed';
        document.getElementById('btn-box').style.top = btnBoxTop + 'px';
        document.getElementById('btn-box').style.left = btnBoxLeft + 'px';
        document.getElementById('btn-box').style.height = btnBoxHeight + 'px';
        document.getElementById('btn-box').style.width = btnBoxWidth + 'px';

        btnHeight = Math.floor(btnBoxHeight / (chordNo.length / btnColSize));
        btnWidth = Math.floor(btnBoxWidth / btnColSize);

        for (let i = 1; i <= chordName.length; i++) {
          let e = document.getElementById('c' + String(i).padStart(2, '0'));
          let en = document.getElementById('cn' + String(i).padStart(2, '0'));
          let tempTop = Math.floor((i - 1) / btnColSize) * btnHeight;
          let tempLeft = ((  (i - 1) % btnColSize  ) * btnWidth) + Math.floor(btnWidth * (1 / 10));

          e.style.position = 'absolute';

          e.style.top = tempTop + 'px';
          e.style.left = tempLeft + 'px';
          e.style.height = Math.floor(btnHeight * (8 / 10)) + 'px';
          e.style.width = Math.floor(btnWidth * (8 / 10)) + 'px';

          if (chordName[i - 1] != '') {
            e.style.visibility = 'visible';
            en.style.visibility = 'visible';
            en.innerHTML = chordName[i - 1]; 
          }
          else {
            e.style.visibility = 'hidden';
            en.style.visibility = 'hidden';
          }

          en.classList.remove('rotated-text');

        }

        let wHeight = keyBoxHeight;
        let bHeight = wHeight - Math.floor(wHeight / 2);

        let wTempWidth = 0;
        let wTempWidthRest = 0;
        let wWidth =  [0,0,0,0,0,0,0];
        let bWidth = [0,0,0,0,0];

        wTempWidth = Math.floor(keyBoxWidth / 7);
        wTempWidthRest = keyBoxWidth - (wTempWidth * 7);

        for (let i = 0; i < wWidth.length; i++) {
          wWidth[i] =  wTempWidth;
        }
        for (let i = 0; i < wTempWidthRest; i++) {
          wWidth[Math.floor(i % 7)] = wWidth[Math.floor(i % 7)] + 1;
        }

        for (let i = 0; i < bWidth.length; i++) {
          bWidth[i] = Math.floor(wWidth[0] / 2);
        }

        let tempLeft = 0;
        for (let i = 0; i < wWidth.length; i++) {
          let e = document.getElementById(wKey[i]);
          e.style.position = 'absolute';
          e.style.top = '0px';
          e.style.left = tempLeft + 'px';
          e.style.height = wHeight + 'px';
          e.style.width = wWidth[i] + 'px';
          e.classList.remove('white-key-v');
          e.classList.add('white-key-h');
          tempLeft = tempLeft + wWidth[i];
        }

        for (let i = 0; i < bKey.length; i++) {
          let eb = document.getElementById(bKey[i]);
          let ew = document.getElementById(bKey[i].substring(0, 1));
          eb.style.position = 'absolute';
          eb.style.top = '0px';
          eb.style.left = (Number(ew.style.left.replace('px', '')) + Math.floor(wWidth[0] / 4) * 3) + 'px';
          eb.style.height = bHeight + 'px';
          eb.style.width = (Math.floor(wWidth[0] / 2)) + 'px';
        }

        const ttl = document.getElementById('ttl');
        ttl.classList.remove('rotated-text');
        ttl.style.position = 'absolute';
        ttl.style.left = '5%';
        ttl.style.top = '50%';
        ttl.style.transform = 'translateY(-50%)';
        ttl.style.fontSize = '';

        document.getElementById('csn').classList.remove('rotated-text');
      }
    }

    let selKey = '';
    let selChord = '';
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    let osc = [null, null, null, null, null, null];

    function playNote(key, chord) {

      if (key == '') {
        return;
      }

      let keyIdx = 0;
      for (let i = 0; i < allKey.length; i++) {
        if (key == allKey[i]) {
          keyIdx = i;
          break;
        }
      }

      let notes = [];
      let cName = '';
      for (let i = 0; i < chordNo.length; i++) {
        if (chord == chordNo[i]) {
          notes = getNoteSets(i);
          cName = chordName[i];
          break;
        }
      }

      if (notes.length == 0) {
        notes = [0];
      }

      let nName = '';
      for (let i = 0; i < notes.length; i++) {
        if (notes[i] == null) {
          continue;
        }

        notes[i] = getNote(parseInt(notes[i]) + keyIdx);

        let noteName = allKey[notes[i]];
        if (nName == '') {
          nName = noteName;
        }
        else {
          nName = nName + ',' + noteName;
        }
      }
      if (notes.length < 2) {
        nName = '';
      }

      let keyAndCode = key + cName;
      for (let i = 0; i < chordValue[cName].length; i++) {
        if (chordValue[cName][i] == null) {
          continue;
        }
      }

      const gain = audioCtx.createGain();
      let gainVal = 0.15;
      if (notes.length > 1) gainVal = 0.4 /  notes.length;
      if (gainVal > 0.3) {
        gainVal = 0.3;
      }

      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(gainVal, audioCtx.currentTime + 0.01);


      for (let i = 0; i < notes.length; i++) {
        if (osc[i] != null) {
          osc[i].stop(audioCtx.currentTime);
          osc[i] = null;
        }
        if (notes[i] == null) {
          continue;
        }
        osc[i] = audioCtx.createOscillator();
        osc[i].type = 'sawtooth'; //sine, square, triangle, sawtooth
        osc[i].frequency.value = frqList[notes[i]];

        osc[i].connect(gain);
        gain.connect(audioCtx.destination);

        osc[i].start();
      }

      if (nName != '') {
        keyAndCode = keyAndCode + '<br>' + nName;
      }
      else {
        keyAndCode = keyAndCode + '<br>&nbsp;';
      }
      document.getElementById('csn').innerHTML = keyAndCode;
    }

    function getNoteSets(idx) {
      let ret = [];
      let keys = Object.keys(chordValue);
      for (let i = 0; i < keys.length; i++) {
        if (keys[i] == chordName[idx]) {
          for (let j = 0; j < chordValue[keys[i]].length; j++) {
            ret[j] = chordValue[keys[i]][j];
          }
          break;
        }
      }
      return ret;
    }

    function getNote(val) {
      if (val == null) return null;
      if (val <= 11) return val;
      else return val - 12;
    }

    function doEvent(isStart) {
      const fadeTime = audioCtx.currentTime + 0.015;

      for (let i = 0; i < osc.length; i++) {
        if (osc[i] != null) {
          try {
            osc[i].stop(fadeTime);
          } catch(e) {}
          osc[i] = null;
        }
      }

      if (isStart) {
        playNote(selKey, selChord);
      }
    }
  </script>
  <style>
    body {
      margin: 0;
      overscroll-behavior-y: none;
      touch-action: pan-x pan-y;
      background-color: #f0f0f0; 
      font-family: Arial, sans-serif; 
    }

    .no_select {
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    #start {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .start-container {
      width: 94%;
      max-width: 700px;
      height: calc(100% - 20px);
      background: white;
      border-radius: 10px;
      padding: 14px 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .start-sound {
      font-size: 16px;
      font-weight: bold;
      text-align: center;
    }

    .start-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 6px;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
    }

    .start-scroll h3 {
      margin-top: 0;
      margin-bottom: 8px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 4px;
    }

    .start-ok {
      padding: 10px 24px;
      font-size: 16px;
      align-self: center;
    }

    @media (orientation: landscape) {
      .start-screen {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .message-box {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        text-align: center;
      }

      .scroll-area {
        margin-top: 60px;
        margin-bottom: 60px;
        overflow-y: auto;
        flex: 1;
      }

      .ok-button {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
      }
    }

    #add-box {
      align-items: center;
      justify-content: center;
      text-align: left;
    }

    #csn-box {
      z-index: 1;
      border: 1px solid black;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    #csn {
      font-size: clamp(14px, 6vw, 32px);
      line-height: 1.2;
    }

    #btn-box {
      z-index: 1;
      border: 1px solid black;
    }

    #key-box {
      z-index: 1;
      border-bottom-left-bottom-right: 0px;
    }

    #ttl {
      font-size: clamp(14px, 4vw, 28px);
      display: inline-block;
    }

    .chord-btn {
      background-color:#e0e0e0;
      color: #333;
      padding: 2px 2px;
      border: 1px solid black;
      border-radius: 6px;
      font-size: initial;
      overflow: hidden;
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 4px 6px rgba(0, 0, 0, 0.1),
        0 1px 3px rgba(0, 0, 0, 0.08);
      display: block;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: clamp(10px, 2.5vw, 22px);
    }

    .white-key {
      background: white;
      border: 1px solid black;
      z-index: 2;
      box-sizing: border-box;
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 4px 6px rgba(0, 0, 0, 0.1),
        0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .white-key-h {
      border-top-left-radius: 0px;
      border-top-right-radius: 0px;
      border-bottom-left-radius: 6px;
      border-bottom-right-radius: 6px;
    }

    .white-key-v {
      border-top-left-radius: 6px;
      border-top-right-radius: 0px;
      border-bottom-left-radius: 6px;
      border-bottom-right-radius: 0px;
    }

    .black-key {
      background: black;
      z-index: 3;
      box-sizing: border-box;
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 4px 6px rgba(0, 0, 0, 0.1),
        0 1px 3px rgba(0, 0, 0, 0.08);
    }
    
    .rotated-text {
      display: inline-block;
      transform: rotate(90deg); 
      transform-origin: center center;
      white-space: nowrap;
    }
    
    .content-container { 
      max-width: 800px; 
      margin: 20px auto; 
      padding: 20px; 
      background-color: white; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .content-container h2 {
      border-bottom: 2px solid #ddd;
      padding-bottom: 5px;
    }
    .content-container ul, .content-container ol {
      text-align: left;
    }
  </style>
</head>
<body style="position:absolute; top:0px;left:0px;" onload="fncLoad()" onresize="fncResize()" class="no_select">
  <div id="start">
    <div class="start-container">

      <div class="start-sound">WEB CHORD KEYBOARD</div>
      <div class="start-sound">This page has sound.</div>

      <div class="start-scroll" id="about-scroll">
        <h3>ABOUT</h3>
        <div id="about"></div>
      </div>

      <div class="start-scroll" id="privacy-scroll">
        <h3>PRIVACY</h3>
        <div id="privacy"></div>
      </div>

      <button class="start-ok" onclick="showMain()">OK</button>

    </div>
  </div>

  <div id="main" style="display:none;">
    <div id="add-box">
      <span id="ttl">WEB CHORD KEYBOARD</span>
    </div>
    <div id="csn-box">
      <span id="csn"></span>
    </div>
    <div id="btn-box">
      <div class="chord-btn" id="c01" data-note="c01"><span id="cn01"></span></div>
      <div class="chord-btn" id="c02" data-note="c02"><span id="cn02"></span></div>
      <div class="chord-btn" id="c03" data-note="c03"><span id="cn03"></span></div>
      <div class="chord-btn" id="c04" data-note="c04"><span id="cn04"></span></div>
      <div class="chord-btn" id="c05" data-note="c05"><span id="cn05"></span></div>
      <div class="chord-btn" id="c06" data-note="c06"><span id="cn06"></span></div>
      <div class="chord-btn" id="c07" data-note="c07"><span id="cn07"></span></div>
      <div class="chord-btn" id="c08" data-note="c08"><span id="cn08"></span></div>
      <div class="chord-btn" id="c09" data-note="c09"><span id="cn09"></span></div>
      <div class="chord-btn" id="c10" data-note="c10"><span id="cn10"></span></div>
      <div class="chord-btn" id="c11" data-note="c11"><span id="cn11"></span></div>
      <div class="chord-btn" id="c12" data-note="c12"><span id="cn12"></span></div>
      <div class="chord-btn" id="c13" data-note="c13"><span id="cn13"></span></div>
      <div class="chord-btn" id="c14" data-note="c14"><span id="cn14"></span></div>
      <div class="chord-btn" id="c15" data-note="c15"><span id="cn15"></span></div>
      <div class="chord-btn" id="c16" data-note="c16"><span id="cn16"></span></div>
      <div class="chord-btn" id="c17" data-note="c17"><span id="cn17"></span></div>
      <div class="chord-btn" id="c18" data-note="c18"><span id="cn18"></span></div>
      <div class="chord-btn" id="c19" data-note="c19"><span id="cn19"></span></div>
      <div class="chord-btn" id="c20" data-note="c20"><span id="cn20"></span></div>
      <div class="chord-btn" id="c21" data-note="c21"><span id="cn21"></span></div>
      <div class="chord-btn" id="c22" data-note="c22"><span id="cn22"></span></div>
      <div class="chord-btn" id="c23" data-note="c23"><span id="cn23"></span></div>
      <div class="chord-btn" id="c24" data-note="c24"><span id="cn24"></span></div>
    </div>
    <div id="key-box">
      <div class="white-key" id="C" data-note="C"></div>
      <div class="black-key" id="C#" data-note="C#"></div>
      <div class="white-key" id="D" data-note="D"></div>
      <div class="black-key" id="D#" data-note="D#"></div>
      <div class="white-key" id="E" data-note="E"></div>
      <div class="white-key" id="F" data-note="F"></div>
      <div class="black-key" id="F#" data-note="F#"></div>
      <div class="white-key" id="G" data-note="G"></div>
      <div class="black-key" id="G#" data-note="G#"></div>
      <div class="white-key" id="A" data-note="A"></div>
      <div class="black-key" id="A#" data-note="A#"></div>
      <div class="white-key" id="B" data-note="B"></div>
    </div>
  </div>

  <script>
    document.querySelectorAll('.white-key, .black-key, .chord-btn').forEach(key => {
      key.addEventListener('touchstart', (e) => {
        if (e.cancelable) e.preventDefault();

        const note = key.dataset.note;
        if (chordNo.indexOf(note) > -1) {
          if (selChord != '') {
            return;
          }
          selChord = note;
          document.getElementById(note).style.backgroundColor = '#fff0f5';
        }
        else if (allKey.indexOf(note) > -1) {
          if (selKey != '') {
            return;
          }
          selKey = note;
          document.getElementById(note).style.backgroundColor = '#fff0f5';
          document.getElementById(note).style.border = '0px';
        }
        else {
          return;
        }
        doEvent(true);
      });
    });

    document.querySelectorAll('.white-key, .black-key, .chord-btn').forEach(key => {
      key.addEventListener('touchend', (e) => {
        if (e.cancelable) e.preventDefault();

        const note = key.dataset.note;
        if (chordNo.indexOf(note) > -1) {
          if (selChord != note) {
            return;
          }
          selChord = "";
          document.getElementById(note).style.backgroundColor = '#e0e0e0';
        }
        else if (allKey.indexOf(note) > -1) {
          if (selKey != note) {
            return;
          }
          selKey = '';
          if (note.indexOf('#') > -1) {
            document.getElementById(note).style.backgroundColor = '#000';
          }
          else {
            document.getElementById(note).style.backgroundColor = '#fff';
            document.getElementById(note).style.border = '1px solid black';
          }
        }
        else {
          return;
        }
        doEvent(false);
      });
    });

    window.addEventListener('orientationchange', function() {
      fncResize();
    });
  </script>
</body>
</html>
